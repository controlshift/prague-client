(function(){describe("DonationsFormModel",function(){var donationsForm,configHash;beforeEach(function(){var loadLocalJson;loadLocalJson=function(){var json;return json=null,$.ajax({async:!1,dataType:"json",url:"config.json",success:function(dat){return json=dat}}),json},configHash=loadLocalJson(),donationsForm=new DonationsFormModel($,configHash)}),describe("Form validations",function(){it("should check for presence of first name",function(){return donationsForm.firstName("Foo"),expect(donationsForm.firstName.isValid()).toBeTruthy(),donationsForm.firstName(null),expect(donationsForm.firstName.isValid()).toBeFalsy()}),it("should return true for a valid email",function(){return donationsForm.email("a@b.com"),expect(donationsForm.email.isValid()).toBeTruthy()}),it("should return false for an invalid email",function(){return donationsForm.email("ab.com"),expect(donationsForm.email.isValid()).toBeFalsy()}),it("should accept a valid cvc",function(){return donationsForm.cvc("432"),expect(donationsForm.cvc.isValid()).toBeTruthy()}),it("should reject an invalid cvc",function(){return donationsForm.cvc("432a"),expect(donationsForm.cvc.isValid()).toBeFalsy()}),it("should accept a valid credit card #",function(){return donationsForm.cardNumber("4242 4242 4242 4242"),expect(donationsForm.cardNumber.isValid()).toBeTruthy()}),it("should reject an invalid credit card #",function(){return donationsForm.cardNumber("4242 4242"),expect(donationsForm.cardNumber.isValid()).toBeFalsy()}),it("should accept a valid date",function(){return donationsForm.cardMonth("01"),donationsForm.cardYear(""+((new Date).getFullYear()+1)),expect(donationsForm.cardDate.isValid()).toBeTruthy()}),it("should reject an old date",function(){return donationsForm.cardMonth("01"),donationsForm.cardYear(""+((new Date).getFullYear()-1)),expect(donationsForm.cardDate.isValid()).toBeFalsy()})}),describe("Parsing query strings",function(){it("should return the expected hash",function(){return expect(donationsForm.parseQueryString("foo=bar&foo2=bar2")).toEqual({foo:"bar",foo2:"bar2"})}),it("should return an empty hash when the query string is undefined or blank",function(){return expect(donationsForm.parseQueryString("")).toEqual({}),expect(donationsForm.parseQueryString(void 0)).toEqual({})})}),describe("Currency conversion",function(){var formWithConversion;beforeEach(function(){var conversionHash;conversionHash=$.extend({seedamount:100,seedvalues:"100,200,300",currencyconversion:"choose"},configHash),formWithConversion=new DonationsFormModel($,conversionHash)}),it("should convert amounts if currencyconversion=choose",function(){return formWithConversion.selectedCurrency("BBD"),expect(formWithConversion.amounts()).toEqual([200,400,600])}),it("should convert amounts if currencyconversion=detect and the country is different",function(){var detectForm,detectHash;return detectHash=$.extend({seedamount:100,seedvalues:"100,200,300",seedcurrency:"BBD",currencyconversion:"choose"},configHash),detectForm=new DonationsFormModel($,detectHash),detectForm.selectedCurrency("USD"),expect(detectForm.amounts()).toEqual([50,100,150])})})})}).call(this);